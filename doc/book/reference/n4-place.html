<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Placement of physical volumes - nain4</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../tutorials.html"><strong aria-hidden="true">2.</strong> Tutorials</a></li><li class="chapter-item expanded "><a href="../how-to.html"><strong aria-hidden="true">3.</strong> How-To Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../how-to/install-nix.html"><strong aria-hidden="true">3.1.</strong> How to install nix</a></li><li class="chapter-item expanded "><a href="../how-to/enable-nain4-in-cmake.html"><strong aria-hidden="true">3.2.</strong> How to make nain4 available in a Geant4/cmake project</a></li><li class="chapter-item expanded "><a href="../how-to/start-a-nain4-based-project.html"><strong aria-hidden="true">3.3.</strong> How start a nain4-based project</a></li><li class="chapter-item expanded "><a href="../how-to/build-a-minimal-nain4-app.html"><strong aria-hidden="true">3.4.</strong> How to build a minimal nain4 app</a></li><li class="chapter-item expanded "><a href="../how-to/upgrade-nain4.html"><strong aria-hidden="true">3.5.</strong> How to upgrade your nain4 dependency</a></li><li class="chapter-item expanded "><a href="../how-to/generate_random_numbers.html"><strong aria-hidden="true">3.6.</strong> How to generate random numbers</a></li></ol></li><li class="chapter-item expanded "><a href="../explanation.html"><strong aria-hidden="true">4.</strong> Explanation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../explanation/placement-laziness-and-accumulation.html"><strong aria-hidden="true">4.1.</strong> Placement: laziness and accumulation</a></li><li class="chapter-item expanded "><a href="../explanation/displacements-and-rotations-are-not-commutative.html"><strong aria-hidden="true">4.2.</strong> Displacements and rotations are not commutative</a></li><li class="chapter-item expanded "><a href="../explanation/input-types-of-boolean-solids-methods.html"><strong aria-hidden="true">4.3.</strong> Input types of boolean solids' methods</a></li><li class="chapter-item expanded "><a href="../explanation/process-hits-return-value.html"><strong aria-hidden="true">4.4.</strong> Return value of G4VSensitiveDetector::ProcessHits</a></li><li class="chapter-item expanded "><a href="../explanation/why-nix.html"><strong aria-hidden="true">4.5.</strong> Why nix?</a></li></ol></li><li class="chapter-item expanded "><a href="../reference.html"><strong aria-hidden="true">5.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/headers.html"><strong aria-hidden="true">5.1.</strong> Headers</a></li><li class="chapter-item expanded "><a href="../reference/n4-shape.html"><strong aria-hidden="true">5.2.</strong> Constructing solids and logical volumes</a></li><li class="chapter-item expanded "><a href="../reference/n4-place.html" class="active"><strong aria-hidden="true">5.3.</strong> Placement of physical volumes</a></li><li class="chapter-item expanded "><a href="../reference/n4-boolean-solids.html"><strong aria-hidden="true">5.4.</strong> Constructing boolean solids</a></li><li class="chapter-item expanded "><a href="../reference/managing-nain4-versions.html"><strong aria-hidden="true">5.5.</strong> Managing nain4 versions</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">nain4</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="placement-of-physical-volumes"><a class="header" href="#placement-of-physical-volumes">Placement of physical volumes</a></h1>
<!-- TODO: put this in some common .css -->
<style>
details.g4 > summary::before {
  font-size: 80%;
  color: #888;
  content: "Click to show/hide equivalent in pure Geant4 ";
}
details.g4 {
  border-style: none none none solid;
  border-color: #888;
  padding-left: 1em;
}
</style>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<h3 id="world-volumes"><a class="header" href="#world-volumes">World volumes</a></h3>
<p><code>nain4</code>'s placement API can be used to place a logical volume as it is being created</p>
<pre><code class="language-c++">auto air = n4::material(&quot;G4_AIR&quot;);
n4::box(&quot;world&quot;).cube(&quot;1*m&quot;).place(air).now();
</code></pre>
<details class="g4"> <summary></summary>
<pre><code class="language-c++">auto air = G4NistManager::Instance() -&gt; FindOrBuildMaterial(&quot;G4_AIR&quot;);
auto world_size = 1*m;
auto world_solid = new G4Box(&quot;world&quot;, world_size/2, world_size/2, world_size/2);
auto world_logical = new G4LogicalVolume(world_solid, air, &quot;world&quot;)
new G4PVPlacement(nullptr, {}, world_logical, &quot;world&quot;, nullptr, false, 0);
</code></pre>
</details>
<p>or to place an existing logical volume</p>
<pre><code class="language-c++">auto air = n4::material(&quot;G4_AIR&quot;);
G4LogicalVolume* existing_logical_volume = n4::box(&quot;world&quot;).cube(1*m).volume(air);
n4::place(existing_logical_volume).now();
</code></pre>
<p><font size=-1>(The Geant4 equivalent of this sample is essentially identical to that of the previous sample.)</font></p>
<p>In the above examples, no mother volume was specified in the placement phase,
therefore these volumes are <em>world</em> volumes: all other volumes must be placed
within the world volume—either directly, or in its daughters—and they must not
protrude beyond the bounds of the world volume.</p>
<!-- TODO replace with an mdbook-admonish thing, or some other higher-level
feature --> <font color="red">NOTE: the volume is not placed until the `.now()`
<p>method is called.</font> See <a href="../explanation/placement-laziness-and-accumulation.html">Placement: Laziness and
Accumulation</a> for more details.</p>
<h3 id="daughter-volumes"><a class="header" href="#daughter-volumes">Daughter volumes</a></h3>
<ul>
<li>Daughter volumes are placed inside a mother volume with the <code>.in(mother)</code>
method.</li>
<li>The position and orientation, as well as other information about the
placement, can be specified with the placement API's auxiliary methods.</li>
</ul>
<p>Just like in the case of world volumes, a logical volume can be placed as it is being created</p>
<pre><code class="language-c++">auto copper = n4::material(&quot;G4_Cu&quot;);
n4::box(&quot;box&quot;).cube(1*cm).place(copper).in(world).at_y(3*cm).rot_z(30*deg).now();
</code></pre>
<details class="g4"> <summary></summary>
<pre><code class="language-c++">auto copper = G4NistManager::Instance() -&gt; FindOrBuildMaterial(&quot;G4_Cu&quot;);
auto box_size = 1*cm;
auto box_solid = new G4Box(&quot;box&quot;, box_size/2, box_size/2, box_size/2);
auto box_logical = new G4LogicalVolume(box_solid, copper, &quot;box&quot;)
auto rot_z_30 = new G4RotationMatrix();
rot_z_30 -&gt; rotateZ(30*deg);
new G4PVPlacement(rot_z_30, {0, 3*cm, 0}, box_logical, &quot;box&quot;, world, false, 0);
</code></pre>
</details>
<p>or in two separate steps</p>
<pre><code class="language-c++">auto copper = n4::material(&quot;G4_Cu&quot;);
auto box = n4::box(&quot;box&quot;).cube(1*cm).volume(copper);
n4::place(box).in(world).at_y(3*cm).rot_z(30*deg).now();
</code></pre>
<h2 id="methods"><a class="header" href="#methods">Methods</a></h2>
<ul>
<li>
<p>Mother volume</p>
<ul>
<li><code>in(logical-volume)</code></li>
<li><code>in(physical-volume)</code> // not implemented yet</li>
<li><code>in(n4::place)</code> // not implemented yet</li>
</ul>
<p>If no mother volume is specified, the placed volume becomes the world volume.
There can be only one world volume in a Geant4 application. <code>nain4</code> issues a
run-time error if more than one world volume is created.</p>
</li>
<li>
<p>Translations</p>
<ul>
<li><code>at(G4ThreeVector)</code></li>
<li><code>at(x,y,z)</code></li>
<li><code>at_x(x)</code>, <code>at_y(y)</code>, <code>at_z(z)</code></li>
</ul>
<p>The above methods specify the displacement of the daughter volume's origin with respect to the mother volume's origin.</p>
<p>By default there is no displacement between the two.</p>
<p>The effect of these methods is cumulative. Thus the following are equivalent</p>
<pre><code class="language-c++">.at  (1*m,      2*m,      3*m)
.at_x(1*m).at_y(2*m).at_z(3*m)
</code></pre>
<p>as are these</p>
<pre><code class="language-c++">.at_x(101*m)
.at_x(1*m).at_x(100*m)
</code></pre>
<p>NOTE: <a href="../explanation/displacements-and-rotations-are-not-commutative.html">Displacements and rotations are not commutative</a>.</p>
</li>
<li>
<p>Rotations</p>
<ul>
<li><code>rotate(G4RotationMatrix)</code>, <code>rot(G4RotationMatrix)</code> (identical meanings)</li>
<li><code>rotate_x(angle)</code>, <code>rotate_y(angle)</code>, <code>rotate_z(angle)</code></li>
<li><code>rot_x(angle)</code>, <code>rot_y(angle)</code>, <code>rot_z(angle)</code> (shorter-named equivalents of the above)</li>
</ul>
<p>The above methods specify the rotation of the daughter volume with respect to its mother volume.</p>
<p>By default there is no rotation between the two.</p>
<p>The effect of these methods is cumulative. Thus, the following two lines are equivalent</p>
<pre><code class="language-c++">.rot_x(60*deg).rot_x(30*deg)
.rot_x(90*deg)
</code></pre>
<p>NOTE: Rotations around distinct axes are not commutative. Thus the following two lines are <strong>NOT</strong> equivalent</p>
<pre><code class="language-c++">.rot_x(90*deg).rot_y(90*deg)
.rot_y(90*deg).rot_x(90*deg)
</code></pre>
<p>NOTE: <a href="../explanation/displacements-and-rotations-are-not-commutative.html">Displacements and rotations are not commutative</a>.</p>
</li>
<li>
<p>Transformations</p>
<ul>
<li><code>transform(G4Transform3D*)</code>, <code>trans(G4Transform3D*)</code> (identical meanings)</li>
</ul>
<p>The above methods specify the overall transformation of the daughter volume with respect to its mother volume.</p>
</li>
<li>
<p><code>name(string)</code> By default the physical volume inherits the name of the logical
volume being placed. This method allows overriding the inherited name.</p>
</li>
<li>
<p><code>copy_no(N)</code> Useful to distinguish between multiple placements of a single
logical volume. Implicitly appends &quot;-N&quot; to the physical volume's name, in
addition to setting an copy-number attribute.</p>
</li>
<li>
<p>Overlap checking</p>
<p>Besides daughter volumes being placed entirely within their mothers, there
should be no overlap between volumes. If this happens, the behaviour of
tracking <a href="https://geant4-forum.web.cern.ch/t/whats-the-consequence-of-overlapping/4914/8">becomes inconsistent</a>.</p>
<p>The following methods control overlap checking.</p>
<p>When overlap checking is enabled, Geant4 will throw a runtime error if
overlaps are detected, as opposed to allowing your program to run with an
ill-defined geometry. However, this process may consume significant resources
and slow down the construction of the geometry. Therefore, you may not want to
have overlap checking enabled permanently.</p>
<ul>
<li>
<p><code>check_overlaps()</code> Activates checking for this placement only.</p>
</li>
<li>
<p><code>n4::place::check_overlaps_switch_on()</code> Activate checking for all placements until further notice.</p>
</li>
<li>
<p><code>n4::place::check_overlaps_switch_off()</code> Deactivate checking until further
notice, for placements which do not have it explicitly enabled with
<code>.check_overlaps()</code>.</p>
</li>
</ul>
</li>
<li>
<p>Controlling state accumulation</p>
<ul>
<li><code>clone()</code> Create an independent copy of the current placement state.</li>
</ul>
<p>Observe the difference in the effect of these two loops, whose source differs
only in the presence/absence of <code>.clone()</code></p>
<pre><code class="language-c++">place_box = n4::box(&quot;box&quot;).cube(1*m).place(copper).in(world);

// Place boxes at 1, 2 and 3 metres
for (auto k : {1,2,3}) { place_box.clone().at_x(k*m).now(); }
// Place boxes at 1, 3 and 6 metres
for (auto k : {1,2,3}) { place_box        .at_x(k*m).now(); }
</code></pre>
<p>See <a href="../explanation/placement-laziness-and-accumulation.html">Placement: Laziness and Accumulation</a>.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/n4-shape.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../reference/n4-boolean-solids.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/n4-shape.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../reference/n4-boolean-solids.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
